!function(a){"use strict";var s=a("form#boombox-login"),e=a("form#boombox-register"),t=a("form#boombox_forgot_password"),r=a("form#boombox_reset_password"),o=null,n=null,i=function(a,s){a.find(".captcha").attr("src",ajax_auth_object.captcha_file_url+"?"+Math.random()+"&type="+s).closest(".captcha-container").removeClass("loading"),a.find(".bb-captcha-field").val("")},c=function(s){switch(s){case"login":var e='.js-authentication[href="#sign-in"]';break;case"register":var e='.js-authentication[href="#registration"]';break;case"forgot-password":case"fp":var e='.js-authentication[href="#forgot-password"]';break;case"reset-password":case"rp":var e='.js-authentication[href="#reset-password"]';break;default:var e=!1}e&&a(e).length>0&&a(e).first().trigger("click")},l=function(a,s,e,t){var r,o,n,i=a.val(),c=s&&s.length?s.val():i,l="bb-pass-strength",m='<div class="pass-progress-bar"></div>';if(!i)return void e.empty();switch(t=t.concat(wp.passwordStrength.userInputBlacklist()),n='<span class="pass-msg-title">'+ajax_auth_object.messages.password_strength+":</span>",r=wp.passwordStrength.meter(i,t,c)){case-1:o=pwsL10n.unknown,l+=" bb-weak-pass";break;case 2:o=pwsL10n.bad,l+=" bb-weak-pass";break;case 3:o=pwsL10n.good,l+=" bb-good-pass";break;case 4:o=pwsL10n.strong,l+=" bb-strong-pass";break;case 5:o=ajax_auth_object.messages.password_mismatch,n="",m="",l+=" bb-mismatch-pass";break;default:o=pwsL10n["short"],l+=" bb-short-pass"}e.html('<div class="'+l+'"><span class="pass-status-msg">'+n+'<span class="pass-msg-value"> '+o+"</span></span>"+m+"</div>")};ajax_auth_object.trigger_action&&"-1"!=a.inArray(ajax_auth_object.trigger_action,["login","register","forgot-password","fp","reset-password","rp"])&&a(window).on("load",function(){c(ajax_auth_object.trigger_action)}),a.validator.addMethod("loginRegex",function(a,s){return this.optional(s)||/^[a-z0-9\-\_]+$/i.test(a)}),a(".js-authentication").lightModal({beforeShow:function(){var r=a(this).hasClass("entry-nsfw");if(s.length>0&&(r&&s.closest(".authentication").addClass("is-nsfw-auth"),s[0].reset(),s.find(".error").removeClass("error"),s.find(".status-msg").html(""),ajax_auth_object.enable_login_captcha))if("image"===ajax_auth_object.captcha_type)i(s,s.attr("action"));else if("google"===ajax_auth_object.captcha_type){var c=s.find("#boombox-login-captcha");null===o?o=grecaptcha.render(c.attr("id"),{sitekey:c.data("boombox-sitekey"),theme:"light"}):grecaptcha.reset(o)}if(e.length>0&&(r&&s.closest(".authentication").addClass("is-nsfw-auth"),e[0].reset(),l(a('[name="signonpassword"]'),!1,a("#bb-register-pass-strength-result"),[]),e.find(".error").removeClass("error"),e.find(".status-msg").html(""),ajax_auth_object.enable_registration_captcha))if("image"===ajax_auth_object.captcha_type)i(e,e.attr("action"));else if("google"===ajax_auth_object.captcha_type){var m=e.find("#boombox-register-captcha");null===n?n=grecaptcha.render(m.attr("id"),{sitekey:m.data("boombox-sitekey"),theme:"light"}):grecaptcha.reset(n)}t.length>0&&(t[0].reset(),t.find(".error").removeClass("error"),t.find(".status-msg").html(""))}}),s.length>0&&s.validate({errorPlacement:function(a,s){}}),e.length>0&&(e.validate({rules:{signonusername:{loginRegex:!0},signongdpr:{required:!0},password2:{equalTo:"#signonpassword"}},invalidHandler:function(s,e){console.log(a(this))},errorPlacement:function(a,s){},highlight:function(s,e){a(s).addClass(e),a(s).is(":checkbox")&&a(s).closest("div").addClass("bb-chkb-err")},unhighlight:function(s,e){a(s).removeClass(e),a(s).is(":checkbox")&&a(s).closest("div").removeClass("bb-chkb-err")}}),e.on("keyup",'[name="signonpassword"]',function(s){l(a('[name="signonpassword"]'),!1,a("#bb-register-pass-strength-result"),[])})),t.length>0&&t.validate({errorPlacement:function(a,s){}}),r.length&&(r.validate({rules:{rppassword:{required:!0},rpconfirmpassword:{required:!0,equalTo:'[name="rppassword"]'}},errorPlacement:function(a,s){}}),r.on("keyup",'[name="rppassword"], [name="rpconfirmpassword"]',function(){l(a('[name="rppassword"]'),a('[name="rpconfirmpassword"]'),a("#bb-rp-pass-strength-result"),[])})),s.on("submit",function(s){var e=a(this),t=e.parent().find("p.status-msg");if(!e.valid())return t.removeClass("msg-success msg-info").addClass("msg-error").html(ajax_auth_object.invalid_message).show(),!1;var r=e.find('[name="useremail"]').val(),n=e.find('[name="password"]').val(),c=e.find('[name="rememberme"]'),l=e.find('[name="security"]').val(),m=e.closest(".authentication").hasClass("is-nsfw-auth"),g=m?ajax_auth_object.nsfw_redirect_url:ajax_auth_object.login_redirect_url,h={action:"boombox_ajax_login",useremail:r,password:n,security:l,redirect:g};c.length&&(h.remember=c.is(":checked")?1:0),ajax_auth_object.enable_login_captcha&&("image"===ajax_auth_object.captcha_type?h.captcha=e.find('[name="captcha-code"]').val():"google"===ajax_auth_object.captcha_type&&(h.captcha=e.find('[name="g-recaptcha-response"]').val())),t.removeClass("msg-success msg-error").addClass("msg-info").html(ajax_auth_object.loading_message).show(),a.post(ajax_auth_object.ajaxurl,h,function(a){1==a.success?(t.removeClass("msg-error msg-info").addClass("msg-success").html(a.data.message),window.location.href=g):(t.removeClass("msg-success msg-info").addClass("msg-error").html(a.data.message),ajax_auth_object.enable_login_captcha&&("image"===ajax_auth_object.captcha_type?i(e,e.attr("action")):"google"===ajax_auth_object.captcha_type&&grecaptcha.reset(o)))}),s.preventDefault()}),e.on("submit",function(s){var e=a(this),t=e.parent().find("p.status-msg");if(!e.valid())return t.removeClass("msg-success msg-info").addClass("msg-error").html(ajax_auth_object.invalid_message).show(),!1;var r=e.find('[name="signonusername"]').val(),o=e.find('[name="signonemail"]').val(),c=e.find('[name="signonpassword"]').val(),l=e.find('[name="signongdpr"]'),m=e.find('[name="signonsecurity"]').val(),g=e.closest(".authentication").hasClass("is-nsfw-auth"),h=g?ajax_auth_object.nsfw_redirect_url:ajax_auth_object.register_redirect_url,d={action:"boombox_ajax_register",username:r,useremail:o,password:c,security:m,redirect:h};l.length&&(d.gdpr=l.is(":checked")?1:0),ajax_auth_object.enable_registration_captcha&&("image"===ajax_auth_object.captcha_type?d.captcha=e.find('[name="signoncaptcha"]').val():"google"===ajax_auth_object.captcha_type&&(d.captcha=e.find('[name="g-recaptcha-response"]').val())),t.removeClass("msg-success msg-error").addClass("msg-info").html(ajax_auth_object.loading_message).show(),a.post(ajax_auth_object.ajaxurl,d,function(a){if(1==a.success){t.removeClass("msg-error msg-info").addClass("msg-success").html(a.data.message);var s=a.data.need_activation||!1;0==s?window.location.href=h:e[0].reset()}else t.removeClass("msg-success msg-info").addClass("msg-error").html(a.data.message),ajax_auth_object.enable_registration_captcha&&("image"===ajax_auth_object.captcha_type?i(e,e.attr("action")):"google"===ajax_auth_object.captcha_type&&grecaptcha.reset(n))}),s.preventDefault()}),t.on("submit",function(s){var e=a(this),t=e.parent().find("p.status-msg");if(!e.valid())return t.removeClass("msg-success msg-info").addClass("msg-error").html(ajax_auth_object.invalid_message).show(),!1;var r=e.find('[name="userlogin"]').val(),o=e.find('[name="forgotsecurity"]').val();return t.removeClass("msg-success msg-error").addClass("msg-info").html(ajax_auth_object.loading_message).show(),a.post(ajax_auth_object.ajaxurl,{action:"boombox_ajax_forgot_password",userlogin:r,security:o},function(a){a.success?(t.removeClass("msg-error msg-info").addClass("msg-success").html(a.data.message),e.remove()):t.removeClass("msg-success msg-info").addClass("msg-error").html(a.data.message)}),s.preventDefault(),!1}),r.on("submit",function(s){var e,t,r,o,n=a(this),i=n.parent().find("p.status-msg");return n.valid()?(e=n.find('[name="rpuserlogin"]').val(),t=n.find('[name="rppassword"]').val(),r=n.find('[name="rpconfirmpassword"]').val(),o=n.find('[name="resetpasswordsecurity"]').val(),i.removeClass("msg-success msg-error").addClass("msg-info").html(ajax_auth_object.loading_message).show(),a.post(ajax_auth_object.ajaxurl,{action:"boombox_ajax_reset_password",userlogin:e,password:t,confirm:r,security:o},function(a){a.success?(i.removeClass("msg-error msg-info").addClass("msg-success").html(a.data.message),window.location.href=ajax_auth_object.reset_password_redirect_url):i.removeClass("msg-success msg-info").addClass("msg-error").html(a.data.message)}),s.preventDefault(),!1):(i.removeClass("msg-success msg-info").addClass("msg-error").html(ajax_auth_object.invalid_message).show(),!1)}),a("body").on("click",".auth-refresh-captcha",function(s){var e=a(this).closest("form"),t=e.attr("action");return i(e,t),!1})}(jQuery);